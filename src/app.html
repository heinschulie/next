<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" />
		<meta name="viewport" content="width=device-width" />
		%sveltekit.head%

		<script>
			function checkIfGoogleTagAssistantIsEnabled() {
				const urlParams = new URLSearchParams(window.location.search);
				const gtm_debug = urlParams.get('gtm_debug');
				return !!gtm_debug;
			}
	
			document.addEventListener('DOMContentLoaded', function() {
				var scriptType = checkIfGoogleTagAssistantIsEnabled() ? 'text/javascript' : 'text/partytown';
				// var scriptType = 'text/partytown';
				var script = document.createElement('script');
				script.type = scriptType;
				script.async = true;
				script.src = 'https://spiffy-sprinkles-88adaf.netlify.app/gtm.js';
				var firstScript = document.getElementsByTagName('script')[0];
				firstScript.parentNode.insertBefore(script, firstScript);
			});
		</script>
		<script type="text/javascript" src="/~partytown/partytown.js"></script>
		<script>
			// Forward the necessary functions to the web worker layer
			let li = true; 
			partytown = {
				forward: ['dataLayer.push'],
				resolveUrl: (url) => {
					
					if (url.hostname === "connect.facebook.net") {
						return new URL('https://spiffy-sprinkles-88adaf.netlify.app/api/analytics?platform=facebook');
					} else if (url.hostname === "static.ads-twitter.com") {
						return new URL('https://spiffy-sprinkles-88adaf.netlify.app/api/analytics?platform=twitter');
					} 
					else if (url.href === "https://snap.licdn.com/li.lms-analytics/insight.min.js" && li) {
						console.log("SAY SOMETHING PRETTY: ", url.searchParams()); 
						li = false;
						return new URL('https://spiffy-sprinkles-88adaf.netlify.app/api/analytics?platform=linkedIn');
					}
					return url;
				},
			}
		</script>
	
	</head>
	<body data-sveltekit-preload-data="tap">	
		<div style="display: contents">%sveltekit.body%</div>
	</body>
</html>
